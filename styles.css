/* ========================================
   CodeMarker - Estilos do Plugin
   ======================================== */

/* Marca√ß√£o de texto destacado */
.codemarker-highlight {
  border-radius: 2px;
  transition: background-color 0.2s ease;
  /* Garantir que a marca√ß√£o n√£o interfira com o fluxo do texto */
  position: relative;
  z-index: 1;
}

/* ========================================
   üî• CORRE√á√ÉO: Al√ßas independentes do background
   ======================================== */

/* Container das al√ßas - ISOLAMENTO TOTAL do background da marca√ß√£o */
.codemarker-handles-container {
  position: relative !important;
  display: inline-block !important;
  width: 0 !important;
  height: 0 !important;
  overflow: visible !important;
  z-index: 9999 !important;
  pointer-events: none !important;
  /* üî• CR√çTICO: Resetar qualquer background herdado */
  background: none !important;
  background-color: transparent !important;
}

/* üî• NOVO: Isolamento espec√≠fico para al√ßas dentro de marca√ß√µes */
.codemarker-highlight .codemarker-handles-container,
.codemarker-highlight .codemarker-handle,
.codemarker-highlight .codemarker-handle-svg {
  background: none !important;
  background-color: transparent !important;
}

/* ========================================
   Al√ßas (Handles) - Estilos Base
   ======================================== */

/* SVG Container das al√ßas */
.codemarker-handle-svg {
  filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
  transform-origin: center;
  opacity: 1;
  pointer-events: auto !important;
  z-index: 10000 !important;
  position: absolute !important;
  /* üî• ISOLAMENTO: Garantir que n√£o herda background */
  background: none !important;
  background-color: transparent !important;
}

/* Elementos internos das al√ßas */
.codemarker-circle,
.codemarker-line {
  transform-origin: center;
  transition: transform 0.1s ease;
  pointer-events: auto !important;
  /* üî• ISOLAMENTO: SVG elements n√£o devem ter background */
  background: none !important;
}

/* üî• ISOLAMENTO ESPEC√çFICO: Al√ßas dentro de qualquer marca√ß√£o */
.codemarker-highlight .codemarker-circle,
.codemarker-highlight .codemarker-line,
.codemarker-highlight .codemarker-handle-svg,
.codemarker-highlight .codemarker-handle {
  background: none !important;
  background-color: transparent !important;
}

/* ========================================
   Al√ßas - Estados de Visibilidade
   ======================================== */

/* Al√ßa oculta - usa scale e opacity para efeito visual */
.codemarker-handle-svg.codemarker-handle-hidden {
  opacity: 0 !important;
  transform: scale(0.8) !important;
  pointer-events: none !important;
  transition: opacity 0.2s ease, transform 0.2s ease !important;
  background: none !important;
}

/* Al√ßa vis√≠vel - escala normal */
.codemarker-handle-svg.codemarker-handle-visible {
  opacity: 1 !important;
  transform: scale(1) !important;
  pointer-events: auto !important;
  /* Pequena anima√ß√£o de entrada */
  animation: fadeInScale 0.2s ease-out;
  background: none !important;
}

/* Anima√ß√£o de entrada suave */
@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* ========================================
   Al√ßas - Efeitos de Hover
   ======================================== */

/* Aumenta o c√≠rculo no hover */
.codemarker-handle-svg:hover .codemarker-circle {
  transform: scale(1.2);
  filter: brightness(1.1);
}

/* Aumenta a linha verticalmente no hover */
.codemarker-handle-svg:hover .codemarker-line {
  transform: scaleY(1.2);
  filter: brightness(1.1);
}

/* Efeito de hover na al√ßa completa */
.codemarker-handle-svg:hover {
  filter: drop-shadow(0px 2px 4px rgba(0, 0, 0, 0.4));
  background: none !important; /* üî• Manter isolamento mesmo no hover */
}

/* ========================================
   Estados de Arraste
   ======================================== */

/* Cursor geral durante arraste */
body.codemarker-dragging {
  cursor: grabbing !important;
  user-select: none !important;
}

/* Cursor espec√≠fico para al√ßa inicial */
body.codemarker-dragging-start {
  cursor: w-resize !important;
}

/* Cursor espec√≠fico para al√ßa final */
body.codemarker-dragging-end {
  cursor: e-resize !important;
}

/* Reduzir opacidade das outras al√ßas durante arraste */
body.codemarker-dragging .codemarker-handle-svg:not(:hover) {
  opacity: 0.5;
  background: none !important;
}

/* ========================================
   üî• ISOLAMENTO ADICIONAL PARA MARCA√á√ïES SOBREPOSTAS
   ======================================== */

/* Garantir que marca√ß√µes aninhadas n√£o afetem al√ßas */
.codemarker-highlight .codemarker-highlight .codemarker-handle-svg,
.codemarker-highlight .codemarker-highlight .codemarker-handle,
.codemarker-highlight .codemarker-highlight .codemarker-handles-container {
  background: none !important;
  background-color: transparent !important;
}

/* Isolamento para qualquer n√≠vel de aninhamento */
.codemarker-highlight * .codemarker-handle-svg,
.codemarker-highlight * .codemarker-handle,
.codemarker-highlight * .codemarker-handles-container {
  background: none !important;
  background-color: transparent !important;
}

/* ========================================
   Compatibilidade e Fixes
   ======================================== */

/* Garantir que as al√ßas apare√ßam acima de outros elementos do Obsidian */
.cm-editor .codemarker-handle-svg {
  z-index: 10000 !important;
  background: none !important;
}

/* Corrigir poss√≠veis conflitos com temas do Obsidian */
.codemarker-highlight * {
  background: inherit !important;
}

/* üî• EXCE√á√ÉO: Al√ßas N√ÉO devem herdar background */
.codemarker-highlight .codemarker-handle-svg,
.codemarker-highlight .codemarker-handle,
.codemarker-highlight .codemarker-handles-container,
.codemarker-highlight .codemarker-circle,
.codemarker-highlight .codemarker-line {
  background: none !important;
  background-color: transparent !important;
}

/* Garantir que o texto dentro da marca√ß√£o mantenha a cor original */
.codemarker-highlight {
  color: inherit !important;
}

/* Fix para modo escuro - garantir contraste das al√ßas */
.theme-dark .codemarker-circle {
  stroke: #ffffff !important;
}

.theme-light .codemarker-circle {
  stroke: #000000 !important;
}

/* ========================================
   Responsividade e Acessibilidade
   ======================================== */

/* Tornar as al√ßas mais vis√≠veis em telas de alta resolu√ß√£o */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .codemarker-handle-svg {
    filter: drop-shadow(0px 1px 3px rgba(0, 0, 0, 0.4));
    background: none !important;
  }
}

/* Melhorar visibilidade para usu√°rios com necessidades especiais */
@media (prefers-contrast: high) {
  .codemarker-circle {
    stroke-width: 2px !important;
  }
  
  .codemarker-line {
    opacity: 0.9 !important;
  }
}

/* Respeitar prefer√™ncia de anima√ß√µes reduzidas */
@media (prefers-reduced-motion: reduce) {
  .codemarker-handle-svg,
  .codemarker-circle,
  .codemarker-line {
    transition: none !important;
    animation: none !important;
  }
  
  .codemarker-handle-svg.codemarker-handle-visible {
    animation: none !important;
  }
}

/* ========================================
   Debug e Desenvolvimento
   ======================================== */

/* Classe para debug - mostrar bordas dos containers */
.codemarker-debug .codemarker-handles-container {
  border: 1px dashed red !important;
  background: rgba(255, 0, 0, 0.1) !important;
}

.codemarker-debug .codemarker-highlight {
  border: 1px dashed blue !important;
}